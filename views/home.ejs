<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body {
            background-image: url("/background3.jpg");
            background-repeat: no-repeat;
            background-size: 100%;
        }
        h1 {
            color: white;
            text-align: center;
            -webkit-text-stroke: 1px blue;
        }
        .cont {
            position: relative;
            left: 600px;
            top: 50px;
            color: white;
            -webkit-text-stroke: 0.5px black;
        }
        .container {
    display: flex;
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically (if needed) */
    gap: 50px; /* Space between destination cards */
    margin-top: 50px; /* Adjust spacing from top */
}

.destination {
    text-align: center;
    color: white;
    -webkit-text-stroke: 0.5px black;
}

.wanttogo {
    display: flex;
    justify-content: center; /* Center horizontally */
    margin-top: 50px; /* Add spacing from the destinations */
}

.card {
    background-color: #2b2b2b; /* Matches the dark theme */
    border: 1px solid #444;
}

.card-title {
    font-size: 1.25rem;
    font-weight: bold;
    color: #bfff9f; /* Light green for titles */
}

.card-text {
    color: #ddd; /* Light gray for descriptions */
}

.card-img-top {
    height: 200px;
    object-fit: cover; /* Ensures uniform image size */
}

    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Destinations</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-2">
        <a class="navbar-brand" style="color: rgb(191, 255, 161)">Destinations</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
            </ul>
            <form method="POST" id='searchForm' action='/search' class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" name="searchKey" type="search" placeholder="Search"
                    aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>

    <div class="container">
        <h1>Welcome</h1>
    </div>
    <div class="container">
        <div class="destination">
            <img id="image" src="/hiking.png" width="100" height="100">
            <br>
            <label class="my-2">Hiking</label>
            <br>
            <button id="hiking" data-destination="hiking" class="btn btn-secondary view-destination"> View </button>
        </div>
        <div class="destination">
            <img id="image" src="/cities.png" width="100" height="100">
            <br>
            <label class="my-2">Cities</label>
            <br>
            <button id="cities" data-destination="cities" class="btn btn-secondary view-destination"> View </button>

        </div>
        <div class="destination">
            <img id="image" src="/islands.png" width="100" height="100">
            <br>
            <label class="my-2">Islands</label>
            <br>
            <button id="islands" data-destination="islands" class="btn btn-secondary view-destination"> View </button>
        </div>
    </div>
    <div class="wanttogo">
        <button id="wanttogo" class="btn btn-secondary" style="width: 300px;">
            Want-to-Go List
        </button>
    </div>

    <div id="wanttogoList" class="container mt-4">
        <h3 class="text-white"></h3>
        <div id="wanttogolist-results" class="row">
            <!-- Search results will be appended here -->
        </div>
    </div>
    
    <div id="results" class="container mt-4">
        <h3 class="text-white"></h3>
        <div id="search-results" class="row">
            <!-- Search results will be appended here -->
        </div>
    </div>


<script>

   // Select the "wanttogo" button and add a click event listener
document.querySelector("#wanttogo").addEventListener("click", async (e) => {
    e.preventDefault(); // Prevent the default button behavior (e.g., form submission)

    try {
        // Make a GET request to the '/wanttogo' endpoint
        const response = await fetch('/wanttogo', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
        });

        // Parse the JSON response
        const res = await response.json();

        // Select the container where the results will be displayed
        const resultsContainer = document.getElementById("wanttogolist-results");

        // Clear any previous results to avoid duplication
        resultsContainer.innerHTML = '';

        if (response.ok) {
            // Check if 'destinations' exist in the response
            if (res.data && Array.isArray(res.data)) {
                // Iterate over each destination and create a card
                res.data.forEach(destination => {
                    const card = `
                        <div class="col-md-4 mb-3">
                            <div class="card bg-dark text-white h-100">
                                <img src="${destination.name.toLowerCase()}.png" class="card-img-top" alt="${destination.name}">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">${destination.name}</h5>
                                    <p class="card-text">${destination.description}</p>
                                    <div class="mt-auto">
                                        <form method="GET" action="/${encodeURIComponent(destination.name)}" class="form-inline my-2 my-lg-0 mb-2">
                                            <button class="btn btn-outline-success btn-block" type="submit">Find More About ${destination.name}</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    // Insert the card into the results container
                    resultsContainer.insertAdjacentHTML("beforeend", card);
                });
            } else {
                // Handle the case where 'destinations' is empty or not an array
                resultsContainer.innerHTML = `<p>No destinations found in your Want-to-Go List.</p>`;
            }
        } else {
            // Handle non-OK HTTP responses
            resultsContainer.innerHTML = `<p style="color: red;">Error: ${data.message || 'Failed to load destinations.'}</p>`;
        }
    } catch (error) {
        // Handle any errors that occurred during the fetch operation
        console.error("Error fetching destinations:", error);
        const resultsContainer = document.getElementById("wanttogolist-results");
        resultsContainer.innerHTML = `<p>Error: ${error.message}</p>`;
    }
});


   const form = document.querySelector("form");
    form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const searchKey = form.searchKey.value;
    const response = await fetch('/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ searchKey })
    });

    const data = await response.json();

    const resultsContainer = document.getElementById("search-results");
    resultsContainer.innerHTML = ""; // Clear previous results

    if (response.ok) {
        document.querySelector('#results > h3:first-child').innerHTML = 'Search Results:';

        data.destinations.forEach(destination => {
            const card = `
                <div class="col-md-4 mb-3">
                    <div class="card bg-dark text-white">
                        <img src="${destination.name.toLowerCase()}.png" class="card-img-top" alt="${destination.name}">
                        <div class="card-body">
                            <h5 class="card-title">${destination.name}</h5>
                            <p class="card-text">${destination.description}</p>
                            <form method="GET" id='searchForm' action='/${destination.name}' class="form-inline my-2 my-lg-0">
                                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">find more about ${destination.name}</button>
                            </form>
                         <form method="POST" id="addToListButton" action="/add-to-want-to-go" class="add-to-list form-inline my-2 my-lg-0">
                            <input type="hidden" name="destinationName" value="${destination.name}">
                            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Add to Want-to-Go List</button>
                        </form>

                        </div>
                    </div>
                </div>
            `;
            resultsContainer.insertAdjacentHTML("beforeend", card);
        });
    } else {
        document.querySelector('#results > h3:first-child').innerHTML = '';
        resultsContainer.innerHTML = `<p class="text-danger">${data.error || data.message}</p>`;
    }
});


document.querySelectorAll('.view-destination').forEach(button => {
    button.addEventListener('click', () => {
        const destination = button.dataset.destination; // Retrieve the destination from the data attribute
        window.location.href = `/${destination}`; // Navigate using GET
    });
});

</script>
</body>
</html>